#!/bin/bash

set -xeu

# Cleanup function
cleanup() {
    rm -f /tmp/opencode-linux-x64.tar.gz
}
trap cleanup EXIT

# Create bin directory if it doesn't exist
mkdir -p $HOME/bin

# Get the latest release download URL for the zip file
DOWNLOAD_URL=$(curl -s https://api.github.com/repos/sst/opencode/releases/latest | grep "browser_download_url.*opencode-linux-x64.tar.gz" | cut -d '"' -f 4)

# Download the zip file
curl -L $DOWNLOAD_URL -o /tmp/opencode-linux-x64.tar.gz

# Extract to $HOME/bin
tar xaf /tmp/opencode-linux-x64.tar.gz -C $HOME/bin opencode

# Make executable
chmod +x $HOME/bin/opencode

echo "opencode installed to $HOME/bin/opencode"
echo "Make sure $HOME/bin is in your PATH"
